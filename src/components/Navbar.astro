---
import { Icon } from "astro-icon/components";
---

<nav class="w-full py-6 mb-8 relative">
  <div class="flex justify-between items-center m-auto max-w-[620px] w-[90%]">
    <a href="/" class="nav-logo">Chris Coyne</a>

    <div class="flex items-center gap-6">
      <ul id="desktopMenu" class="hidden sm:flex items-center gap-6">
        <li><a href="/" class="nav-link">About</a></li>
        <li><a href="/art" class="nav-link">Art</a></li>
        <li><a href="/blog" class="nav-link">Blog</a></li>
      </ul>

      <button
        id="themeToggle"
        aria-label="toggle darkmode"
        class="nav-icon-btn"
      >
        <Icon name="mdi:white-balance-sunny" size={16} />
      </button>

      <button
        id="hamburgerMenu"
        aria-label="open menu"
        class="nav-icon-btn hamburger-btn"
      >
        <Icon name="mdi:menu" size={18} class="hamburgerIcon" />
      </button>
    </div>
  </div>

  <!-- Mobile Menu -->
  <div id="mobileMenu" class="mobile-menu">
    <div class="m-auto max-w-[620px] w-[90%] py-6">
      <ul class="flex flex-col gap-1">
        <li><a href="/" class="mobile-link">About</a></li>
        <li><a href="/art" class="mobile-link">Art</a></li>
        <li><a href="/blog" class="mobile-link">Blog</a></li>
      </ul>
    </div>
  </div>
</nav>

<style>
  .nav-logo {
    font-size: 0.9375rem;
    font-weight: 600;
    letter-spacing: -0.01em;
    color: var(--color-text);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .nav-logo:hover {
    color: var(--color-text-muted);
  }

  .nav-link {
    font-size: 0.875rem;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .nav-link:hover {
    color: var(--color-text);
  }

  .nav-icon-btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 2rem;
    height: 2rem;
    color: var(--color-text-muted);
    background: none;
    border: none;
    cursor: pointer;
    transition: color 0.2s ease;
  }

  .nav-icon-btn:hover {
    color: var(--color-text);
  }

  .mobile-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--color-bg);
    border-bottom: 1px solid var(--color-border);
    z-index: 50;
  }

  .mobile-menu.show {
    display: block;
  }

  .mobile-link {
    display: block;
    padding: 0.625rem 0;
    font-size: 0.9375rem;
    color: var(--color-text-muted);
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .mobile-link:hover {
    color: var(--color-text);
  }

  .hamburger-btn {
    display: inline-flex;
  }

  @media (min-width: 640px) {
    .hamburger-btn {
      display: none;
    }
  }

  .hamburgerIcon {
    transition: transform 0.3s ease;
  }

  .hamburgerIcon.rotate {
    transform: rotate(90deg);
  }
</style>

<script>
  function init() {
    const themeToggleButton = document.getElementById("themeToggle");
    const hamburgerMenu = document.getElementById("hamburgerMenu");
    const mobileMenu = document.getElementById("mobileMenu");
    const hamburgerIcon = document.querySelector(".hamburgerIcon");

    if (themeToggleButton) {
      themeToggleButton.addEventListener("click", function handleToggleClick() {
        let theme = localStorage.getItem("theme") || "dark";
        const newTheme = theme === "dark" ? "light" : "dark";
        document.documentElement.setAttribute("data-theme", newTheme);
        localStorage.setItem("theme", newTheme);
      });
    }

    if (hamburgerMenu && mobileMenu && hamburgerIcon) {
      hamburgerMenu.addEventListener("click", function () {
        const isOpen = mobileMenu.classList.contains("show");
        if (isOpen) {
          mobileMenu.classList.remove("show");
          hamburgerIcon.classList.remove("rotate");
        } else {
          mobileMenu.classList.add("show");
          hamburgerIcon.classList.add("rotate");
        }
      });

      const mobileLinks = mobileMenu.querySelectorAll("a");
      mobileLinks.forEach((link) => {
        link.addEventListener("click", function () {
          mobileMenu.classList.remove("show");
          hamburgerIcon.classList.remove("rotate");
        });
      });

      document.addEventListener("click", function (event) {
        const target = event.target as Node;
        if (!hamburgerMenu.contains(target) && !mobileMenu.contains(target)) {
          mobileMenu.classList.remove("show");
          hamburgerIcon.classList.remove("rotate");
        }
      });
    }
  }

  init();
  document.addEventListener("astro:after-swap", () => {
    init();
  });
</script>
